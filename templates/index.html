<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeBreaker | The Logic Game</title>
    <style>
        /* MINIMALIST DARK THEME */
        body {
            margin: 0;
            font-family: 'Courier New', Courier, monospace;
            background-color: #121213;
            color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            text-align: center;
        }
        .container { max-width: 600px; padding: 20px; width: 90%; }
        h1 { font-size: 3.5rem; letter-spacing: 5px; margin-bottom: 0; text-transform: uppercase;}
        p.subtitle { color: #818384; margin-top: 10px; font-size: 1.2rem; }
        
        .settings-box {
            background: #272729;
            padding: 20px;
            border-radius: 10px;
            margin: 30px 0;
            text-align: left;
        }
        .setting-row { margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        label { font-weight: bold; color: #b0b3b8; }
        
        select {
            width: 100%; padding: 10px;
            background: #121213; border: 1px solid #3a3a3c;
            color: white; border-radius: 5px; font-family: inherit; margin-top: 5px;
        }

        /* BUTTONS */
        .btn-start {
            background-color: #538d4e; color: white; border: none;
            padding: 15px 40px; font-size: 1.5rem; cursor: pointer;
            border-radius: 50px; font-weight: bold; width: 100%;
            transition: transform 0.2s;
        }
        .btn-start:hover { transform: scale(1.05); }
        .btn-rules {
            background: transparent; color: #818384; border: 1px solid #3a3a3c;
            padding: 10px 20px; margin-top: 15px; cursor: pointer;
            border-radius: 20px; font-family: inherit;
        }
        .btn-rules:hover { color: white; border-color: white; }

        /* MODAL STYLES */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.85); justify-content: center; align-items: center;
        }
        .modal-content {
            background-color: #121213; border: 1px solid #3a3a3c; padding: 20px;
            border-radius: 10px; width: 90%; max-width: 500px; text-align: left; position: relative;
        }
        .close-btn { position: absolute; top: 10px; right: 15px; font-size: 24px; cursor: pointer; color: #818384; }
        
        /* NEW: VISUAL DOTS FOR RULES */
        .example-row { display: flex; align-items: center; gap: 15px; margin: 10px 0; }
        .dot { 
            width: 15px; height: 15px; border-radius: 50%; 
            border: 2px solid #3a3a3c; display: inline-block; flex-shrink: 0;
        }
        .bull { background-color: #538d4e; border-color: #538d4e; box-shadow: 0 0 5px #538d4e; }
        .cow  { background-color: #b59f3b; border-color: #b59f3b; box-shadow: 0 0 5px #b59f3b; }
        .miss { background-color: #3a3a3c; border-color: #3a3a3c; }
        .ring { background-color: transparent; }
    </style>
</head>
<body>

    <div class="container">
        <h1>CodeBreaker</h1>
        <p class="subtitle">Crack the code. Watch your step.</p>

        <div class="settings-box">
            <div style="margin-bottom: 20px;">
                <label>Difficulty Level</label>
                <select id="difficulty">
                    <option value="easy">Rookie (3 Digits)</option>
                    <option value="standard" selected>Standard (4 Digits)</option>
                    <option value="hard">Expert (5 Digits)</option>
                    <option value="master">Master (4 Digits + Repeats)</option>
                    <option value="insane">Insane (6 Digits + Repeats)</option>
                </select>
            </div>
            
            <div class="setting-row">
                <label for="timer-toggle" style="cursor:pointer;">‚ö° Enable Timer (3 Mins)</label>
                <input type="checkbox" id="timer-toggle" style="width: 20px; height: 20px; accent-color: #cf6679;">
            </div>

            <div class="setting-row">
                <label for="infinity-toggle" style="cursor:pointer;">‚ôæÔ∏è Unlimited Attempts</label>
                <input type="checkbox" id="infinity-toggle" style="width: 20px; height: 20px; accent-color: #538d4e;">
            </div>
        </div>

        <button class="btn-start" onclick="startGame()">START GAME</button>
        <br>
        <button class="btn-rules" onclick="toggleModal(true)">How to Play?</button>
    </div>

    <div id="rulesModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="toggleModal(false)">&times;</span>
            <h2 style="margin-top: 0; text-align: center;">OPERATOR'S MANUAL</h2>
            
            <hr style="border-color: #3a3a3c;">

            <h3 style="color: #538d4e; margin-bottom: 5px;">1. The Logic</h3>
            
            <p style="color: #cf6679; font-size: 0.9rem; font-style: italic; margin-top: 0; text-align: center; border: 1px solid #cf6679; padding: 5px; border-radius: 5px;">
                ‚ö†Ô∏è ORDER DOES NOT MATTER.<br>
                The dots are shuffled. They do NOT correspond to the position of the numbers.
            </p>

            <div class="example-row">
                <span class="dot bull"></span> 
                <span><strong>BULL:</strong> Correct Number, Correct Spot.</span>
            </div>
            <div class="example-row">
                <span class="dot cow"></span>
                <span><strong>COW:</strong> Correct Number, Wrong Spot.</span>
            </div>
            <div class="example-row">
                <span class="dot miss"></span>
                <span><strong>GRAY:</strong> Wrong Number completely.</span>
            </div>
            <div class="example-row">
                <span class="dot ring"></span>
                <span><strong>HOLLOW:</strong> Waiting for input.</span>
            </div>

            <h3 style="color: #b59f3b; margin-bottom: 10px;">2. Tools</h3>
            <ul style="padding-left: 20px; line-height: 1.4; color: #d1d1d1; font-size: 0.95rem;">
                <li><strong>üïµÔ∏è Detective:</strong> Right-Click pad to strike out.</li>
                <li><strong>üí° Hint:</strong> Reveals one correct digit.</li>
                <li><strong>üè≥Ô∏è Surrender:</strong> Reveal code.</li>
            </ul>

            <h3 style="color: #cf6679; margin-bottom: 10px;">3. Special Modes</h3>
            <ul style="padding-left: 20px; line-height: 1.4; color: #d1d1d1; font-size: 0.95rem;">
                <li><strong>‚ö° Timer:</strong> 3 Minutes to crack the code.</li>
                <li><strong>‚ôæÔ∏è Unlimited:</strong> Endless guesses. Rows appear as you need them.</li>
            </ul>
            
            <br>
            <div style="text-align: center;">
                <button class="btn-start" style="padding: 10px 30px;" onclick="toggleModal(false)">ACKNOWLEDGE</button>
            </div>
        </div>
    </div>

    <script>
        function toggleModal(show) {
            const modal = document.getElementById('rulesModal');
            modal.style.display = show ? 'flex' : 'none';
        }

        function startGame() {
            const diff = document.getElementById('difficulty').value;
            const timerOn = document.getElementById('timer-toggle').checked;
            const infinityOn = document.getElementById('infinity-toggle').checked;

            // 1. Default Settings
            let settings = { length: 4, repeats: false, max_attempts: 10, mode: 'standard' };
            
            // 2. Adjust Settings
            if (diff === 'easy')   settings = { length: 3, repeats: false, max_attempts: 10, mode: 'rookie' };
            if (diff === 'hard')   settings = { length: 5, repeats: false, max_attempts: 12, mode: 'expert' };
            if (diff === 'master') settings = { length: 4, repeats: true,  max_attempts: 12, mode: 'master' };
            if (diff === 'insane') settings = { length: 6, repeats: true,  max_attempts: 15, mode: 'insane' };

            // 3. Modifiers
            if (timerOn) settings.timer = 180;
            if (infinityOn) settings.max_attempts = 10000;
            
            // 4. Send to Server
            fetch('/api/new_game', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(settings)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    if (diff === 'easy') window.location.href = "/game/rookie";
                    else if (diff === 'standard') window.location.href = "/game/standard";
                    else if (diff === 'hard') window.location.href = "/game/expert";
                    else if (diff === 'master') window.location.href = "/game/master";
                    else if (diff === 'insane') window.location.href = "/game/insane";
                }
            });
        }
    </script>
</body>
</html>